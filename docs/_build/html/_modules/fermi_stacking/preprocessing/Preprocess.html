
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fermi_stacking.preprocessing.Preprocess &#8212; fermi_stacking  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for fermi_stacking.preprocessing.Preprocess</h1><div class="highlight"><pre>
<span></span><span class="c1">############################################################</span>
<span class="c1"># </span>
<span class="c1"># Written by Chris Karwin; April 2022; Clemson University.</span>
<span class="c1"># </span>
<span class="c1"># Significant restructuring by Chris Karwin Feb 2024; </span>
<span class="c1"># NASA Goddard Space Flight Center. </span>
<span class="c1">#</span>
<span class="c1"># Based on original code from Marco Ajello, Vaidehi Paliya, and Abhishek Desai.</span>
<span class="c1">#</span>
<span class="c1"># Purpose: Main script for Fermi-LAT stacking analysis.</span>
<span class="c1">#</span>
<span class="c1">###########################################################</span>

<span class="c1">########################################</span>
<span class="c1"># Imports</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="kn">import</span> <span class="nn">resource</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span><span class="nn">shutil</span><span class="o">,</span><span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> 
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;TkAgg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">fermipy.gtanalysis</span> <span class="kn">import</span> <span class="n">GTAnalysis</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">pyLikelihood</span> 
<span class="kn">from</span> <span class="nn">BinnedAnalysis</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">import</span> <span class="nn">matplotlib.mlab</span> <span class="k">as</span> <span class="nn">mlab</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="kn">import</span> <span class="n">gaussian_filter</span>
<span class="kn">from</span> <span class="nn">astropy.convolution</span> <span class="kn">import</span> <span class="n">convolve</span><span class="p">,</span> <span class="n">Gaussian2DKernel</span>
<span class="kn">from</span> <span class="nn">matplotlib.cm</span> <span class="kn">import</span> <span class="n">register_cmap</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span><span class="p">,</span> <span class="n">interpolate</span><span class="p">,</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span><span class="p">,</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">scipy.stats.contingency</span> <span class="kn">import</span> <span class="n">margins</span>
<span class="kn">import</span> <span class="nn">fermi_stacking.pop_studies.PopStudies</span> <span class="k">as</span> <span class="nn">PS</span>
<span class="kn">from</span> <span class="nn">IntegralUpperLimit</span> <span class="kn">import</span> <span class="n">calc_int</span>
<span class="kn">from</span> <span class="nn">UpperLimits</span> <span class="kn">import</span> <span class="n">UpperLimits</span>
<span class="kn">from</span> <span class="nn">SummedLikelihood</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="c1">#######################################</span>

<span class="c1"># Superclass:</span>
<div class="viewcode-block" id="StackingAnalysis"><a class="viewcode-back" href="../../../api/preprocess.html#fermi_stacking.preprocessing.Preprocess.StackingAnalysis">[docs]</a><span class="k">class</span> <span class="nc">StackingAnalysis</span><span class="p">:</span>
   
    <span class="sd">&quot;&quot;&quot;Superclass for conducting Fermi-LAT stacking.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    sample_file : str</span>
<span class="sd">        Full path to sample file. </span>
<span class="sd">    file_type : str</span>
<span class="sd">        Type for the sample file. Must be either &#39;csv&#39;, &#39;fits&#39;, or &#39;tab&#39;.</span>
<span class="sd">    column_name : str</span>
<span class="sd">        Header of name column in sample file. </span>
<span class="sd">    column_ra : str</span>
<span class="sd">        Header of ra column in sample file.</span>
<span class="sd">    column_dec : str</span>
<span class="sd">        Header of dec column in sample file. </span>
<span class="sd">    ft1 : str</span>
<span class="sd">        Full path to ft1 photon data file. </span>
<span class="sd">    ft2 : str</span>
<span class="sd">        Full path to spacecraft file. </span>
<span class="sd">    galdiff : str</span>
<span class="sd">        Full path to Galactic diffuse model.</span>
<span class="sd">    isodiff : str</span>
<span class="sd">        Full path to isotropic model.</span>
<span class="sd">    ltcube : str, optional</span>
<span class="sd">        Full path to precomputed ltcube (the default is &#39;None&#39;, in</span>
<span class="sd">        which case the ltcube is calculated on the fly).</span>
<span class="sd">    use_scratch : bool</span>
<span class="sd">        If True, will perform analysis in scratch directory.</span>
<span class="sd">    scratch : str</span>
<span class="sd">        Full path to sratch directory.</span>
<span class="sd">    JLA : bool</span>
<span class="sd">        If True will perform joint likelihood analysis, using 4 </span>
<span class="sd">        different PSF classes. If False, a standard analysis will</span>
<span class="sd">        be performed. </span>
<span class="sd">    irfs : str</span>
<span class="sd">        Name of LAT instrument response functions.</span>
<span class="sd">    emin : float or int</span>
<span class="sd">        Miminum energy of analysis in MeV. </span>
<span class="sd">    emax : float or int</span>
<span class="sd">        Maximum energy of analysis in MeV. </span>
<span class="sd">    tmin : float or int</span>
<span class="sd">        Minimum time of analysis in mission elapsed time (MET).</span>
<span class="sd">    tmax : float or int</span>
<span class="sd">        Maximum time of analysis in mission elapsed time (MET).</span>
<span class="sd">    zmax : float or int</span>
<span class="sd">        Maximun zenith angle to use in the analysis in degrees. </span>
<span class="sd">    index_min : float</span>
<span class="sd">         Minimum index for stacking scan (absolute value).</span>
<span class="sd">    index_max : float</span>
<span class="sd">        Maximum index for stacking scan (absolute value).</span>
<span class="sd">    flux_min : float</span>
<span class="sd">        Power of min flux for stacking scan.</span>
<span class="sd">    flux_max : float</span>
<span class="sd">        Power of max flux for stacking scan.</span>
<span class="sd">    num_flux_bins : int</span>
<span class="sd">        Number of flux bins to use.</span>
<span class="sd">    calc_sed : bool</span>
<span class="sd">        If True will calculate SED. </span>
<span class="sd">    sed_logEbins : list</span>
<span class="sd">        Log of energy bin edges for SED calculation. </span>
<span class="sd">    delete_4fgl : bool</span>
<span class="sd">        Option to run 4FGL source. If True, must provide </span>
<span class="sd">        &quot;remove_list.csv&quot; file in run directory, with col1=sample_name, </span>
<span class="sd">        col2=4fgl_name, and no header.</span>
<span class="sd">    show_plots : bool</span>
<span class="sd">        If True will show plots. Set to False for submitted batch jobs. </span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    All inputs are passed with inputs.yaml file.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">input_yaml</span><span class="p">):</span>

        <span class="c1"># Get home directory:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
	
        <span class="c1"># Load main inputs from yaml file:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_yaml</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">Loader</span><span class="o">=</span><span class="n">yaml</span><span class="o">.</span><span class="n">FullLoader</span><span class="p">)</span>

        <span class="c1"># Main default inputs:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ft1</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ft1&quot;</span><span class="p">]</span> <span class="c1"># data file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ft2</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ft2&quot;</span><span class="p">]</span> <span class="c1"># spacecraft file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">galdiff</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;galdiff&quot;</span><span class="p">]</span> <span class="c1"># Galactic diffuse model	</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isodiff</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;isodiff&quot;</span><span class="p">]</span> <span class="c1"># isotropic model</span>

        <span class="c1"># ltcube:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltcube</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;ltcube&quot;</span><span class="p">]</span>
   
        <span class="c1"># Scratch directory:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_scratch</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;use_scratch&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scratch</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scratch</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;scratch&quot;</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scratch</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">scratch</span><span class="p">)</span>
      
        <span class="c1"># Perform joint likelihood analysis (True) or standard analysis (False):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">JLA</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;JLA&quot;</span><span class="p">]</span>
        
        <span class="c1"># Main analysis parameters:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">irfs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;irfs&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emin</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;emin&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emax</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;emax&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmin</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;tmin&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmax</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;tmax&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmax</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;zmax&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_min</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;index_min&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_max</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;index_max&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux_min</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;flux_min&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flux_max</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;flux_max&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_flux_bins</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;num_flux_bins&quot;</span><span class="p">]</span>

        <span class="c1"># Option to run 4FGL sources:</span>
        <span class="c1"># Note: If True, must provide &quot;remove_list.csv&quot; file in run directory, with col1=sample_name, col2=4fgl_name, and no header.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_4fgl</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;delete_4fgl&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_4fgl</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;remove_list.csv&quot;</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col0&quot;</span><span class="p">,</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_sample_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;col0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_4fgl_name</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        
        <span class="c1"># Additional options:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;show_plots&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_sed</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;calc_sed&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logEbins</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;sed_logEbins&quot;</span><span class="p">]</span>

        <span class="c1"># Sample data:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_file</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;sample_file&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;file_type&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_name</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;column_name&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;fits&quot;</span><span class="p">:</span>
            <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_file</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name_list</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;tab&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sample_file</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sample_name_list</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<div class="viewcode-block" id="StackingAnalysis.ang_sep"><a class="viewcode-back" href="../../../api/preprocess.html#fermi_stacking.preprocessing.Preprocess.StackingAnalysis.ang_sep">[docs]</a>    <span class="k">def</span> <span class="nf">ang_sep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ra0</span><span class="p">,</span> <span class="n">dec0</span><span class="p">,</span> <span class="n">ra1</span><span class="p">,</span> <span class="n">dec1</span><span class="p">):</span>
       
        <span class="sd">&quot;&quot;&quot;Calculate angular distance between two points on the sky.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ra0 : float</span>
<span class="sd">            Right ascension of first source in degrees. </span>
<span class="sd">        dec0 : float</span>
<span class="sd">            Declination of first source in degrees.</span>
<span class="sd">        ra1 : float</span>
<span class="sd">            Right ascension of second source in degrees.</span>
<span class="sd">        dec1 : float</span>
<span class="sd">            Declination of first source in degrees.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Angular distance between two sources in degrees. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">d0</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">dec0</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">dec1</span>
        <span class="n">r12</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">ra0</span> <span class="o">-</span> <span class="n">ra1</span><span class="p">)</span>
        <span class="n">cd0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span>
        <span class="n">sd0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span>
        <span class="n">cd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
        <span class="n">sd1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
        <span class="n">cr12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">r12</span><span class="p">)</span>
        <span class="n">sr12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">r12</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cd0</span> <span class="o">*</span> <span class="n">sr12</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">cd1</span> <span class="o">*</span> <span class="n">sd0</span> <span class="o">-</span> <span class="n">sd1</span> <span class="o">*</span> <span class="n">cd0</span> <span class="o">*</span> <span class="n">cr12</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">sd0</span> <span class="o">*</span> <span class="n">sd1</span> <span class="o">+</span> <span class="n">cd0</span> <span class="o">*</span> <span class="n">cd1</span> <span class="o">*</span> <span class="n">cr12</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span> <span class="o">/</span> <span class="n">C</span></div>

<div class="viewcode-block" id="StackingAnalysis.run_preprocessing"><a class="viewcode-back" href="../../../api/preprocess.html#fermi_stacking.preprocessing.Preprocess.StackingAnalysis.run_preprocessing">[docs]</a>    <span class="k">def</span> <span class="nf">run_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">srcname</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">):</span>
       
        <span class="sd">&quot;&quot;&quot;Perform preprocessing of source.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        srcname : str </span>
<span class="sd">            Name of source.</span>
<span class="sd">        ra : float</span>
<span class="sd">            Right ascension of source. </span>
<span class="sd">        dec : float</span>
<span class="sd">            Declination of source. </span>
<span class="sd">        &quot;&quot;&quot;</span>

	<span class="c1"># Make print statement:</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running preprocessing...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
 
        <span class="c1"># Need to specify coordinates as type float</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>

        <span class="c1"># Define main output directory for source:</span>
        <span class="n">preprocess_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span><span class="s2">&quot;Preprocessed_Sources&quot;</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">preprocess_output</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">preprocess_output</span><span class="p">)</span>

        <span class="c1"># Remove src output directory if it already exists:</span>
        <span class="n">src_output_main</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">preprocess_output</span><span class="p">,</span><span class="n">srcname</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">src_output_main</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">src_output_main</span><span class="p">)</span>
        <span class="c1"># Make src output directory:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src_output_main</span><span class="p">)</span>

        <span class="c1"># Define scratch directory for source:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scratch</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">preprocess_scratch</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scratch</span><span class="p">,</span><span class="s2">&quot;Preprocessing&quot;</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">preprocess_scratch</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">preprocess_scratch</span><span class="p">)</span>
            <span class="n">src_scratch</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">preprocess_scratch</span><span class="p">,</span><span class="n">srcname</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">src_scratch</span><span class="p">)</span><span class="o">==</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">src_scratch</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;mkdir </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src_scratch</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">src_scratch</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scratch</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
             <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">src_output_main</span><span class="p">)</span>
        	
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.yaml&#39;</span> <span class="o">%</span> <span class="n">srcname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">yml</span><span class="p">:</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;logging:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  verbosity : 3</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  chatter : 3</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fileio:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  outdir : output</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  logfile : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  usescratch : False</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  scratchdir : scratch</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  evfile : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">ft1</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  scfile : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">ft2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ltcube</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  ltcube : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">ltcube</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;binning:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  roiwidth : 10</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  binsz : 0.08</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  binsperdec : 8</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;selection:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  emin : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">emin</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  emax : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">emax</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  zmax : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">zmax</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  target : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  radius : 15</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  tmin : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">tmin</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  tmax : </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">tmax</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  evclass : 128</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  evtype : 3</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  filter : &#39;DATA_QUAL&gt;0 &amp;&amp; LAT_CONFIG==1&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;gtlike:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>  
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  edisp : True</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  edisp_disable : [&#39;isodiff&#39;]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  irfs : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">irfs</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  src_radius : 15</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  src_roiwidth : 15</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  galdiff : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">galdiff</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  isodiff : &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">isodiff</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  catalogs :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    - &#39;4FGL-DR3&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  extdir : &#39;/zfs/astrohe/Software/fermipy_source/lib/python3.9/site-packages/fermipy-1.1.3+2.g21485-py3.9.egg/fermipy/data/catalogs/Extended_12years/&#39;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  sources :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;    - { &#39;name&#39; : &#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;ra&#39; : </span><span class="si">%s</span><span class="s2">, &#39;dec&#39; : </span><span class="si">%s</span><span class="s2">, &#39;SpectrumType&#39; : PowerLaw }</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">srcname</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">))</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;plotting:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  format : png</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#--------#</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;sed:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  use_local_index : True</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
	        
            <span class="c1"># Include components for joint likelihood analysis (JLA):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">JLA</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;components:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - { model: {isodiff: iso_P8R3_SOURCE_V3_PSF0_v1.txt},</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      selection : { evtype : 4 } }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - { model: {isodiff: iso_P8R3_SOURCE_V3_PSF1_v1.txt},</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      selection : { evtype : 8 } }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - { model: {isodiff: iso_P8R3_SOURCE_V3_PSF2_v1.txt},</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      selection : { evtype : 16 } }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  - { model: {isodiff: iso_P8R3_SOURCE_V3_PSF3_v1.txt},</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">yml</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;      selection : { evtype : 32 } }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">yml</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	
        <span class="n">gta</span> <span class="o">=</span> <span class="n">GTAnalysis</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.yaml&#39;</span> <span class="o">%</span> <span class="n">srcname</span><span class="p">,</span><span class="n">logging</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;verbosity&#39;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
    
        <span class="c1"># if rerunning 4fgl source, first delete source from model:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_4fgl</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">delete_sample_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_sample_name</span>
            <span class="n">delete_4fgl_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete_4fgl_name</span>
            <span class="k">if</span> <span class="n">srcname</span> <span class="ow">in</span> <span class="n">delete_sample_name</span><span class="p">:</span>
                <span class="n">this_index</span> <span class="o">=</span> <span class="n">srcname</span> <span class="o">==</span> <span class="n">delete_sample_name</span>
                <span class="n">this_name</span> <span class="o">=</span> <span class="n">delete_4fgl_name</span><span class="p">[</span><span class="n">this_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">gta</span><span class="o">.</span><span class="n">delete_source</span><span class="p">(</span><span class="n">this_name</span><span class="p">)</span>

        <span class="n">gta</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">print_roi</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="s1">&#39;galdiff&#39;</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="s1">&#39;isodiff&#39;</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="mi">25</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">pars</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">distance</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">write_roi</span><span class="p">(</span><span class="s1">&#39;fit_model_1&#39;</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">delete_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
        <span class="n">model2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Index&#39;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s1">&#39;SpatialModel&#39;</span> <span class="p">:</span> <span class="s1">&#39;PointSource&#39;</span><span class="p">}</span>
        <span class="n">finder2</span> <span class="o">=</span> <span class="n">gta</span><span class="o">.</span><span class="n">find_sources</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;find2&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model2</span><span class="p">,</span><span class="n">sqrt_ts_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
				<span class="n">min_separation</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">sources_per_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
				<span class="n">tsmap_fitter</span><span class="o">=</span><span class="s1">&#39;tsmap&#39;</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">write_roi</span><span class="p">(</span><span class="s1">&#39;fit_model_2&#39;</span><span class="p">)</span>

        <span class="n">names2</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))])</span>
        <span class="n">ra_ns2</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;ra&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))])</span>
        <span class="n">dec_ns2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;dec&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))])</span>
        <span class="n">r95_ns2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;pos_r95&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">finder2</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]))])</span>
        <span class="n">dist_sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="mi">0</span>
        <span class="n">namee</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
	
	<span class="c1"># Check ang separation if more than one source is found close to ra and dec</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">names2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names2</span><span class="p">)):</span>
                <span class="n">sepp2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ang_sep</span><span class="p">(</span><span class="n">ra_ns2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dec_ns2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sepp2</span> <span class="o">&lt;</span> <span class="n">r95_ns2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="n">sepp2</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">names2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">sepp2</span><span class="p">,</span><span class="n">r95_ns2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">dist_sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">sepp2</span>
                    <span class="n">namee</span> <span class="o">=</span> <span class="n">names2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">namee</span><span class="p">:</span>                   
            <span class="c1"># Write name of replaced source:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output/replaced_source_name.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">([</span><span class="n">srcname</span><span class="p">,</span><span class="n">namee</span><span class="p">]))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">srcname</span><span class="o">=</span><span class="n">namee</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">,{</span> <span class="s1">&#39;ra&#39;</span> <span class="p">:</span> <span class="n">ra</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span> <span class="p">:</span> <span class="n">dec</span><span class="p">,</span>
        		<span class="s1">&#39;SpectrumType&#39;</span> <span class="p">:</span> <span class="s1">&#39;PowerLaw&#39;</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        		<span class="s1">&#39;Scale&#39;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;Prefactor&#39;</span> <span class="p">:</span> <span class="mf">1e-11</span><span class="p">,</span>
        		<span class="s1">&#39;SpatialModel&#39;</span> <span class="p">:</span> <span class="s1">&#39;PointSource&#39;</span> <span class="p">})</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">print_roi</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="s1">&#39;galdiff&#39;</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">distance</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">gta</span><span class="o">.</span><span class="n">write_roi</span><span class="p">(</span><span class="s1">&#39;fit_model_3&#39;</span><span class="p">)</span>
        
        <span class="c1"># Calculate SED:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_sed</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">sed</span><span class="p">(</span><span class="n">srcname</span><span class="p">,</span><span class="n">loge_bins</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">logEbins</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;output/fit_model_3.npy&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">srcname</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">])</span><span class="o">==</span><span class="s1">&#39;nan&#39;</span><span class="p">:</span>	<span class="c1"># To check non-convergence</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fit has not converged&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">free</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">write_roi</span><span class="p">(</span><span class="s1">&#39;fit_model_3&#39;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;output/fit_model_3.npy&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">srcname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fit has converged&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;param_values&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="n">model4</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Index&#39;</span> <span class="p">:</span> <span class="mf">2.8</span><span class="p">,</span> <span class="s1">&#39;SpatialModel&#39;</span> <span class="p">:</span> <span class="s1">&#39;PointSource&#39;</span><span class="p">}</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Source still bad TS=</span><span class="si">%s</span><span class="s1"> Index=</span><span class="si">%s</span><span class="s1">?&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">],</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;param_values&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****************************&#39;</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">delete_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">mapp</span><span class="o">=</span><span class="n">gta</span><span class="o">.</span><span class="n">tsmap</span><span class="p">(</span><span class="s1">&#39;fit_no_source_final&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model4</span><span class="p">)</span>
            <span class="n">finder4</span> <span class="o">=</span> <span class="n">gta</span><span class="o">.</span><span class="n">find_sources</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;find4&#39;</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model4</span><span class="p">,</span><span class="n">sqrt_ts_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
                      <span class="n">min_separation</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">sources_per_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                      <span class="n">tsmap_fitter</span><span class="o">=</span><span class="s1">&#39;tsmap&#39;</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">,{</span> <span class="s1">&#39;ra&#39;</span> <span class="p">:</span> <span class="n">ra</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span> <span class="p">:</span> <span class="n">dec</span><span class="p">,</span>
                	<span class="s1">&#39;SpectrumType&#39;</span> <span class="p">:</span> <span class="s1">&#39;PowerLaw&#39;</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                	<span class="s1">&#39;Scale&#39;</span> <span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;Prefactor&#39;</span> <span class="p">:</span> <span class="mf">1e-11</span><span class="p">,</span>
                	<span class="s1">&#39;SpatialModel&#39;</span> <span class="p">:</span> <span class="s1">&#39;PointSource&#39;</span> <span class="p">})</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">pars</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">,</span><span class="n">distance</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">free_sources</span><span class="p">(</span><span class="n">minmax_ts</span><span class="o">=</span><span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">distance</span><span class="o">=</span><span class="mf">7.0</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">free_source</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="n">gta</span><span class="o">.</span><span class="n">write_roi</span><span class="p">(</span><span class="s1">&#39;fit_model_3&#39;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;output/fit_model_3.npy&#39;</span><span class="p">,</span><span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">][</span><span class="n">srcname</span><span class="p">]</span>

        <span class="n">TS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span>
        <span class="n">Flux</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;eflux&#39;</span><span class="p">]</span>
        <span class="n">Flux_err</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;eflux_err&#39;</span><span class="p">]</span>
        <span class="n">Flux_UL</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2e</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;eflux_ul95&#39;</span><span class="p">]</span>
        <span class="n">Index</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;param_values&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">Index_err</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="n">src</span><span class="p">[</span><span class="s1">&#39;param_errors&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_Param.txt&#39;</span> <span class="o">%</span> <span class="n">srcname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dist_sep</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Flux</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Flux_err</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Index</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Index_err</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Flux_UL</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">TS</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	 
        <span class="c1"># Calculate likelihood for null hypothesis:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">JLA</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">iteration_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">JLA</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">iteration_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">iteration_list</span><span class="p">:</span>

            <span class="n">srcmap</span> <span class="o">=</span> <span class="s1">&#39;output/srcmap_0</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span><span class="n">j</span>
            <span class="n">bexpmap</span> <span class="o">=</span> <span class="s1">&#39;output/bexpmap_0</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span><span class="n">j</span>
            <span class="n">xmlfile</span> <span class="o">=</span> <span class="s1">&#39;output/fit_model_3_0</span><span class="si">%s</span><span class="s1">.xml&#39;</span> <span class="o">%</span><span class="n">j</span>
            <span class="n">savexml</span> <span class="o">=</span> <span class="s1">&#39;output/null_likelihood_</span><span class="si">%s</span><span class="s1">.xml&#39;</span><span class="o">%</span><span class="n">j</span>
            <span class="n">savetxt</span> <span class="o">=</span> <span class="s1">&#39;output/null_likelihood_</span><span class="si">%s</span><span class="s1">.txt&#39;</span> <span class="o">%</span><span class="n">j</span>

            <span class="n">obs</span> <span class="o">=</span> <span class="n">BinnedObs</span><span class="p">(</span><span class="n">srcMaps</span><span class="o">=</span><span class="n">srcmap</span><span class="p">,</span><span class="n">expCube</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ltcube</span><span class="p">,</span><span class="n">binnedExpMap</span><span class="o">=</span><span class="n">bexpmap</span><span class="p">,</span><span class="n">irfs</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">irfs</span><span class="p">)</span>
            <span class="n">like</span> <span class="o">=</span> <span class="n">BinnedAnalysis</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span><span class="n">xmlfile</span><span class="p">,</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;Minuit&#39;</span><span class="p">)</span> 
            <span class="n">like</span><span class="o">.</span><span class="n">deleteSource</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">freeze</span><span class="o">=</span><span class="n">like</span><span class="o">.</span><span class="n">freeze</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">like</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">)):</span>
                <span class="n">freeze</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">like</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;galdiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="s1">&#39;Prefactor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setFree</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">like</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;galdiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setFree</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">like</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;isodiff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="s1">&#39;Spectrum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="s1">&#39;Normalization&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setFree</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">likeobj</span> <span class="o">=</span> <span class="n">pyLike</span><span class="o">.</span><span class="n">Minuit</span><span class="p">(</span><span class="n">like</span><span class="o">.</span><span class="n">logLike</span><span class="p">)</span>
            <span class="n">thisL</span> <span class="o">=</span> <span class="n">like</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">covar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">optObject</span><span class="o">=</span><span class="n">likeobj</span><span class="p">)</span> <span class="c1">#this returns -logL</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">like</span><span class="o">.</span><span class="n">logLike</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="c1">#this returns logL</span>
            <span class="n">like</span><span class="o">.</span><span class="n">logLike</span><span class="o">.</span><span class="n">writeXml</span><span class="p">(</span><span class="n">savexml</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*********&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-logL: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">thisL</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">()</span> 
	
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">savetxt</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_scratch</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_scratch</span><span class="p">,</span><span class="n">src_output_main</span><span class="p">,</span><span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="StackingAnalysis.make_preprocessing_summary"><a class="viewcode-back" href="../../../api/preprocess.html#fermi_stacking.preprocessing.Preprocess.StackingAnalysis.make_preprocessing_summary">[docs]</a>    <span class="k">def</span> <span class="nf">make_preprocessing_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Makes sumarray of preprocessing.&quot;&quot;&quot;</span>

        <span class="c1"># Construct empty dataframe:</span>
        <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;dist_sep&quot;</span><span class="p">,</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span><span class="s2">&quot;flux_err&quot;</span><span class="p">,</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="s2">&quot;index_err&quot;</span><span class="p">,</span><span class="s2">&quot;flux_ul&quot;</span><span class="p">,</span><span class="s2">&quot;TS&quot;</span><span class="p">])</span>

        <span class="c1"># Fill dataframe:</span>
        <span class="n">missing_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_name_list</span><span class="p">:</span>
	
            <span class="n">srcname</span> <span class="o">=</span> <span class="n">each</span>
            
            <span class="c1"># Check for updated name:</span>
            <span class="n">indir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span><span class="s2">&quot;Preprocessed_Sources&quot;</span><span class="p">,</span><span class="n">srcname</span><span class="p">,</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
            <span class="n">new_name_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indir</span><span class="p">,</span><span class="s2">&quot;replaced_source_name.txt&quot;</span><span class="p">)</span>
            <span class="n">replace_name</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">new_name_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_name_file</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
                <span class="n">this_list</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">newsrcname</span> <span class="o">=</span> <span class="n">this_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">replace_name</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">src_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_Param.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">srcname</span><span class="p">,</span><span class="n">srcname</span><span class="p">)</span>
            <span class="n">wdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span><span class="s2">&quot;Preprocessed_Sources&quot;</span><span class="p">,</span><span class="n">src_file</span><span class="p">)</span> 
	    
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wdir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">replace_name</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">src_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">_Param.txt&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">srcname</span><span class="p">,</span><span class="n">newsrcname</span><span class="p">)</span>
                <span class="n">wdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span><span class="s2">&quot;Preprocessed_Sources&quot;</span><span class="p">,</span><span class="n">src_file</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wdir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">missing_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">srcname</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Does not exists: &quot;</span> <span class="o">+</span> <span class="n">srcname</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">()</span> 
		
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">wdir</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">this_file</span> <span class="o">=</span> <span class="n">wdir</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">this_file</span><span class="p">,</span><span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;dist_sep&quot;</span><span class="p">,</span><span class="s2">&quot;flux&quot;</span><span class="p">,</span><span class="s2">&quot;flux_err&quot;</span><span class="p">,</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="s2">&quot;index_err&quot;</span><span class="p">,</span><span class="s2">&quot;flux_ul&quot;</span><span class="p">,</span><span class="s2">&quot;TS&quot;</span><span class="p">])</span>
                <span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">df_full</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df_full</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TS&quot;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">df_full</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># Write dataframe to text file:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Preprocessed_Sources/preprocessing_summary_LLAGN.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*****************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;preprocessing summary:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df_full</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;****************</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Missing sources:&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">missing_list</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">df_full</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;Preprocessed_Sources/preprocessing_summary_LLAGN.csv&quot;</span><span class="p">,</span><span class="n">sep</span> <span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
        <span class="k">return</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">fermi_stacking</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2024, Chris Karwin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>